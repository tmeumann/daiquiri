FROM ubuntu:20.04

RUN apt-get update \
    && DEBIAN_FRONTEND=noninteractive apt-get -y install build-essential ssh gdbserver \
    && apt-get clean

RUN mkdir /etc/daiquiri && ln -s /app/streams.json /etc/daiquiri/streams.json
WORKDIR /pdna

COPY PowerDNA_Linux_4.10.1.14.tgz /pdna/
RUN tar xzf PowerDNA_Linux_4.10.1.14.tgz \
    && cd /pdna/PowerDNA_4.10.1/src \
    && make \
    && make install

WORKDIR /app

COPY . /app

EXPOSE 3030 5555 1234

CMD ["gdbserver", ":1234", "/app/target/x86_64-unknown-linux-gnu/debug/daiquiri"]
